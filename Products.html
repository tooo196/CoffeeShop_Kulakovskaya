<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Наши продукты">
  <meta name="keywords" content="кофе, продукты, купить кофе">
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" href="Images/favicon.ico" type="image/x-icon">
  <title>Продукты - Кофейный магазин</title>
  <script src="js/app.js"></script>
</head>
<body>
  <header style="text-align: center;">
    <h1>Наши продукты</h1>
    <nav>
      <ul>
        <li><a href="index.html">Главная</a></li>
        <li><a href="About.html">О нас</a></li>
        <li><a href="Products.html">Продукты</a></li>
        <li><a href="News.html">Новости</a></li>
        <li><a href="Contacts.html">Контакты</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>Наши продукты</h2>

    <!-- Фильтры -->
    <div class="filters">
      <div class="filter-group">
        <label for="coffee-type">Тип кофе</label>
        <select id="coffee-type">
          <option value="all">Все типы</option>
          <option value="grain">Зерновой</option>
          <option value="ground">Молотый</option>
          <option value="instant">Растворимый</option>
          <option value="capsules">Капсулы</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="coffee-weight">Вес упаковки</label>
        <select id="coffee-weight">
          <option value="all">Любой</option>
          <option value="100">100 г</option>
          <option value="250">250 г</option>
          <option value="500">500 г</option>
          <option value="1000">1 кг</option>
        </select>
      </div>

      <div class="filter-group">
        <label for="coffee-price">Цена до</label>
        <input type="range" id="coffee-price" min="100" max="2000" step="100" value="2000">
        <span id="price-value">2000 руб.</span>
      </div>
    </div>

    <!-- Список продуктов -->
    <ul class="product-list" id="product-list">
      <!-- Продукты добавляются через JavaScript -->
    </ul>
  </main>

  <!-- Корзина -->
  <div class="cart-container" id="cart-container">
    <div class="cart-header">
      <h3>Корзина</h3>
      <span id="cart-count">0</span>
    </div>
    <div class="cart-items" id="cart-items">
      <!-- Товары в корзину тоже добавляются через JavaScript -->
    </div>
    <div class="cart-total">
      Итого: <span id="cart-total">0</span> руб.
    </div>
    <button class="checkout-btn" id="checkout-btn">Оформить заказ</button>
  </div>

  <!-- Форма оформления заказа -->
  <div class="checkout-modal" id="checkout-modal">
    <div class="checkout-form">
      <button class="close-modal" id="close-modal">&times;</button>
      <h2>Оформление заказа</h2>
      <form id="order-form">
        <div class="form-group">
          <label for="name">Имя</label>
          <input type="text" id="name" required>
        </div>
        <div class="form-group">
          <label for="phone">Телефон</label>
          <input type="tel" id="phone" required>
        </div>
        <div class="form-group">
          <label for="email">Email</label>
          <input type="email" id="email" required>
        </div>
        <div class="form-group">
          <label for="address">Адрес доставки</label>
          <textarea id="address" required></textarea>
        </div>
        <button type="submit" class="submit-order">Заказать</button>
      </form>
    </div>
  </div>

  <!-- Анимация грузовика -->
  <svg class="truck-animation" id="truck-animation" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100">
    <!-- Кузов грузовика -->
    <rect x="30" y="40" width="120" height="40" fill="#6F4E37"/>
    <!-- Кабина -->
    <rect x="150" y="30" width="40" height="50" fill="#5a3c2a"/>
    <!-- Окно -->
    <rect x="160" y="40" width="20" height="20" fill="#a3d1ff"/>
    <!-- Колеса -->
    <circle cx="60" cy="80" r="15" fill="#333"/>
    <circle cx="60" cy="80" r="5" fill="#ccc"/>
    <circle cx="140" cy="80" r="15" fill="#333"/>
    <circle cx="140" cy="80" r="5" fill="#ccc"/>
    <!-- Логотип -->
    <text x="70" y="65" fill="white" font-size="20" text-anchor="middle">COFFEE</text>
  </svg>

  <footer>
    <p>© 2025 Кофейный магазин</p>
  </footer>

  <script>
    // Данные продуктов
    const products = [
      {
        id: 1,
        name: "Эспрессо зерновой",
        type: "grain",
        weight: 250,
        price: 450,
        image: "Images/coffee1.jpg",
        stock: 10
      },
      {
        id: 2,
        name: "Латте молотый",
        type: "ground",
        weight: 100,
        price: 350,
        image: "Images/coffee2.jpg",
        stock: 5
      },
      {
        id: 3,
        name: "Капучино растворимый",
        type: "instant",
        weight: 100,
        price: 300,
        image: "Images/coffee3.jpg",
        stock: 8
      },
      {
        id: 4,
        name: "Арабика зерновая",
        type: "grain",
        weight: 500,
        price: 700,
        image: "Images/coffee4.jpg",
        stock: 15
      },
      {
        id: 5,
        name: "Робуста молотая",
        type: "ground",
        weight: 250,
        price: 400,
        image: "Images/coffee5.jpg",
        stock: 7
      },
      {
        id: 6,
        name: "Капсулы Espresso",
        type: "capsules",
        weight: 10,
        price: 600,
        image: "Images/coffee6.jpg",
        stock: 20
      },
      {
        id: 7,
        name: "Растворимый классический",
        type: "instant",
        weight: 100,
        price: 250,
        image: "Images/coffee7.jpg",
        stock: 12
      },
      {
        id: 8,
        name: "Зерновой премиум",
        type: "grain",
        weight: 1000,
        price: 1200,
        image: "Images/coffee8.jpg",
        stock: 3
      }
    ];

    // Корзина
    let cart = [];

    // DOM элементы
    const productList = document.getElementById('product-list');
    const cartContainer = document.getElementById('cart-container');
    const cartItems = document.getElementById('cart-items');
    const cartCount = document.getElementById('cart-count');
    const cartTotal = document.getElementById('cart-total');
    const checkoutBtn = document.getElementById('checkout-btn');
    const checkoutModal = document.getElementById('checkout-modal');
    const closeModal = document.getElementById('close-modal');
    const orderForm = document.getElementById('order-form');
    const truckAnimation = document.getElementById('truck-animation');
    const coffeeTypeFilter = document.getElementById('coffee-type');
    const coffeeWeightFilter = document.getElementById('coffee-weight');
    const coffeePriceFilter = document.getElementById('coffee-price');
    const priceValue = document.getElementById('price-value');

    // Инициализация приложения
    function init() {
      renderProducts(products);
      setupEventListeners();
      updateCart();
    }

    // Рендер списка продуктов
    function renderProducts(productsToRender) {
      productList.innerHTML = '';

      productsToRender.forEach(product => {
        const productItem = document.createElement('li');
        productItem.innerHTML = `
          <img src="${product.image}" class="coffee-img" width="300" height="300" alt="${product.name}">
          <h3>${product.name}</h3>
          <p>${getTypeName(product.type)} ${product.weight} г</p>
          <p><strong>${product.price} руб.</strong></p>
          <div class="product-controls">
            <input type="number" min="1" max="${product.stock}" value="1" id="quantity-${product.id}">
            <button class="add-to-cart" data-id="${product.id}">В корзину</button>
          </div>
          ${product.stock < 5 ? `<p class="low-stock">Осталось всего ${product.stock} шт.</p>` : ''}
        `;
        productList.appendChild(productItem);
      });
    }

    // Получение читаемого названия типа кофе
    function getTypeName(type) {
      const types = {
        'grain': 'Зерновой',
        'ground': 'Молотый',
        'instant': 'Растворимый',
        'capsules': 'Капсулы'
      };
      return types[type] || type;
    }

    // Настройка обработчиков событий
    function setupEventListeners() {
      // Фильтры
      coffeeTypeFilter.addEventListener('change', applyFilters);
      coffeeWeightFilter.addEventListener('change', applyFilters);
      coffeePriceFilter.addEventListener('input', function() {
        priceValue.textContent = `${this.value} руб.`;
        applyFilters();
      });

      // Добавление в корзину (делегирование событий)
      productList.addEventListener('click', function(e) {
        if (e.target.classList.contains('add-to-cart')) {
          const productId = parseInt(e.target.getAttribute('data-id'));
          const quantityInput = document.getElementById(`quantity-${productId}`);
          const quantity = parseInt(quantityInput.value);
          addToCart(productId, quantity);
        }
      });

      // Корзина и оформление заказа
      checkoutBtn.addEventListener('click', openCheckoutModal);
      closeModal.addEventListener('click', closeCheckoutModal);
      orderForm.addEventListener('submit', submitOrder);
    }

    // Применение фильтров
    function applyFilters() {
      const type = coffeeTypeFilter.value;
      const weight = coffeeWeightFilter.value;
      const maxPrice = parseInt(coffeePriceFilter.value);

      let filteredProducts = products;

      if (type !== 'all') {
        filteredProducts = filteredProducts.filter(p => p.type === type);
      }

      if (weight !== 'all') {
        filteredProducts = filteredProducts.filter(p => p.weight === parseInt(weight));
      }

      filteredProducts = filteredProducts.filter(p => p.price <= maxPrice);

      renderProducts(filteredProducts);
    }

    // Добавление товара в корзину
    function addToCart(productId, quantity) {
      const product = products.find(p => p.id === productId);

      if (!product) return;

      if (quantity > product.stock) {
        alert(`Извините, доступно только ${product.stock} шт. этого товара.`);
        return;
      }

      const existingItem = cart.find(item => item.id === productId);

      if (existingItem) {
        if (existingItem.quantity + quantity > product.stock) {
          alert(`Нельзя добавить больше товара, чем есть в наличии. Доступно: ${product.stock - existingItem.quantity} шт.`);
          return;
        }
        existingItem.quantity += quantity;
      } else {
        cart.push({
          id: productId,
          name: product.name,
          price: product.price,
          quantity: quantity,
          image: product.image
        });
      }

      updateCart();
      alert('Товар добавлен в корзину!');
    }

    // Обновление корзины
    function updateCart() {
      cartItems.innerHTML = '';

      if (cart.length === 0) {
        cartItems.innerHTML = '<p>Корзина пуста</p>';
        cartCount.textContent = '0';
        cartTotal.textContent = '0';
        return;
      }

      let total = 0;
      let totalCount = 0;

      cart.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        totalCount += item.quantity;

        const cartItem = document.createElement('div');
        cartItem.className = 'cart-item';
        cartItem.innerHTML = `
          <img src="${item.image}" width="50" height="50" alt="${item.name}">
          <div>
            <p>${item.name}</p>
            <p>${item.price} руб. × ${item.quantity}</p>
          </div>
          <button class="remove-item" data-id="${item.id}">×</button>
        `;
        cartItems.appendChild(cartItem);
      });

      // Обработчики для кнопок удаления
      document.querySelectorAll('.remove-item').forEach(btn => {
        btn.addEventListener('click', function() {
          const itemId = parseInt(this.getAttribute('data-id'));
          removeFromCart(itemId);
        });
      });

      cartCount.textContent = totalCount;
      cartTotal.textContent = total;
    }

    // Удаление товара из корзины
    function removeFromCart(productId) {
      cart = cart.filter(item => item.id !== productId);
      updateCart();
    }

    // Открытие модального окна оформления заказа
    function openCheckoutModal() {
      if (cart.length === 0) {
        alert('Корзина пуста!');
        return;
      }
      checkoutModal.classList.add('active');
    }

    // Закрытие модального окна
    function closeCheckoutModal() {
      checkoutModal.classList.remove('active');
    }

    // Оформление заказа
    function submitOrder(e) {
      e.preventDefault();

      const name = document.getElementById('name').value;
      const phone = document.getElementById('phone').value;
      const email = document.getElementById('email').value;
      const address = document.getElementById('address').value;

      // Здесь должна быть логика отправки данных на сервер
      console.log('Заказ оформлен:', {
        customer: { name, phone, email, address },
        items: cart,
        total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0)
      });

      // Показываем анимацию грузовика
      checkoutModal.classList.remove('active');
      truckAnimation.classList.add('active');

      // Через 3 секунды очищаем корзину и скрываем анимацию
      setTimeout(() => {
        cart = [];
        updateCart();
        truckAnimation.classList.remove('active');
        alert('Заказ успешно оформлен! Спасибо за покупку!');
      }, 3000);
    }

    // Запуск приложения
    document.addEventListener('DOMContentLoaded', init);

  </script>
</body>
</html>
